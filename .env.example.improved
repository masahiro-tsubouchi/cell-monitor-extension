# =======================================================
# JupyterLab Cell Monitor Extension - 改善版環境変数設定
# =======================================================
# このファイルをコピーして .env ファイルを作成してください
# cp .env.example.improved .env

# =======================================================
# 🌍 環境設定 (CENTRAL CONFIGURATION)
# =======================================================
# 実行環境（development, production, test）
NODE_ENV=development

# ベースホスト設定（1箇所変更で全体に反映）
# 開発環境: localhost, 本番環境: サーバーIP
SERVER_HOST=localhost
SERVER_IP=${SERVER_HOST}

# プロトコル設定（環境に応じて自動切り替え）
USE_HTTPS=false
HTTP_PROTOCOL=${USE_HTTPS:+https:}${USE_HTTPS:-http:}
WS_PROTOCOL=${USE_HTTPS:+wss:}${USE_HTTPS:-ws:}

# ポート設定
INSTRUCTOR_DASHBOARD_PORT=3000
JUPYTERLAB_PORT=8888
FASTAPI_PORT=8000
POSTGRES_PORT=5432
INFLUXDB_PORT=8086
REDIS_PORT=6379

# Docker UID/GID
HOST_UID=1000
HOST_GID=1000

# =======================================================
# 🌐 外部アクセス用URL（ブラウザからのアクセス）
# =======================================================
# フロントエンド設定 (instructor-dashboard)
REACT_APP_API_BASE_URL=${HTTP_PROTOCOL}//${SERVER_IP}:${FASTAPI_PORT}/api/v1
REACT_APP_WS_URL=${WS_PROTOCOL}//${SERVER_IP}:${FASTAPI_PORT}
REACT_APP_DEBUG=${NODE_ENV:+true}

# JupyterLab Extension用
CELL_MONITOR_SERVER_URL=${HTTP_PROTOCOL}//${SERVER_IP}:${FASTAPI_PORT}/api/v1/events
JUPYTERLAB_URL=${HTTP_PROTOCOL}//${SERVER_IP}:${JUPYTERLAB_PORT}
FASTAPI_URL=${HTTP_PROTOCOL}//${SERVER_IP}:${FASTAPI_PORT}/api/v1/events

# =======================================================
# 🐳 Docker内部通信用設定（コンテナ間通信）
# =======================================================
# サービス内部ホスト名（Dockerネットワーク内）
POSTGRES_SERVER=postgres
REDIS_HOST=redis
INFLUXDB_SERVER=http://influxdb

# =======================================================
# 🚀 FastAPIサーバー設定
# =======================================================
PROJECT_NAME=Student Progress Tracker API
PROJECT_VERSION=1.0.0
API_V1_STR=/api/v1

# CORS設定（動的に生成）
BACKEND_CORS_ORIGINS=${HTTP_PROTOCOL}//${SERVER_IP}:${JUPYTERLAB_PORT},${HTTP_PROTOCOL}//${SERVER_IP}:${INSTRUCTOR_DASHBOARD_PORT},http://jupyterlab:8888

# ログレベル
LOG_LEVEL=INFO
DEBUG=${NODE_ENV:+true}

# =======================================================
# 🗄️ データベース設定
# =======================================================
# PostgreSQL
POSTGRES_USER=admin
POSTGRES_PASSWORD=secretpassword
POSTGRES_DB=progress_db

# InfluxDB（時系列データ）
INFLUXDB_INIT_USERNAME=admin
INFLUXDB_INIT_PASSWORD=secretpassword
INFLUXDB_INIT_ORG=my-org
INFLUXDB_INIT_BUCKET=progress_bucket
INFLUXDB_INIT_ADMIN_TOKEN=my-super-secret-token

# =======================================================
# 🔐 セキュリティ設定
# =======================================================
SECRET_KEY=your-secret-key-here-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# JupyterLab認証（開発環境用）
JUPYTER_TOKEN=easy

# =======================================================
# 🧪 JupyterLab拡張機能設定
# =======================================================
CELL_MONITOR_DEFAULT_EMAIL=student001@example.com
CELL_MONITOR_DEFAULT_TEAM=チームA
CELL_MONITOR_DEFAULT_USER=テスト学生001
CELL_MONITOR_TEST_MODE=true

# CSP設定
CSP_FASTAPI_HOSTS=fastapi:8000,${SERVER_IP}:${FASTAPI_PORT},127.0.0.1:${FASTAPI_PORT}

# =======================================================
# 🔧 Docker Build設定
# =======================================================
PYTHON_VERSION=3.12-slim
NODE_VERSION=18-alpine
NODE_MAJOR_VERSION=20
JUPYTERLAB_VERSION=4.0
POSTGRES_VERSION=16-alpine
REDIS_VERSION=7-alpine
INFLUXDB_VERSION=2.7

# =======================================================
# 🔍 監視・ログ設定
# =======================================================
LOG_FORMAT=json
LOG_ROTATION=daily
ENABLE_METRICS=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=3

# =======================================================
# 🌟 環境別プリセット設定例
# =======================================================

# 【開発環境】
# SERVER_HOST=localhost
# USE_HTTPS=false
# NODE_ENV=development

# 【本番環境】
# SERVER_HOST=192.168.1.100  # <- サーバーIPに変更
# USE_HTTPS=true
# NODE_ENV=production
# SECRET_KEY=$(openssl rand -hex 64)
# POSTGRES_PASSWORD=$(openssl rand -hex 32)
# INFLUXDB_INIT_ADMIN_TOKEN=$(openssl rand -hex 32)
# JUPYTER_TOKEN=$(openssl rand -hex 16)

# 【ステージング環境】
# SERVER_HOST=staging.example.com
# USE_HTTPS=true
# NODE_ENV=staging