# 講師支援ダッシュボード開発計画書

> **バージョン**: 2.0.0
> **最終更新日**: 2025-01-27
> **対象**: 開発者・プロジェクトマネージャー・UI/UXデザイナー
> **ヒアリング完了**: 2025-01-27

## 📋 プロジェクト概要

### 目標
JupyterLab Cell Monitor Extension のバックエンドAPI（186個のテストケース完全成功）を活用した、講師支援に特化したリアルタイムダッシュボードの開発。

### 最優先機能
1. **座席のヘルプ要請表示**: どこの座席の誰がヘルプを要請しているかの即座の把握
2. **講師対応状況表示**: 講師の対応可能状況とリアルタイム位置情報
3. **スマートフォン通知**: 講師への即座のプッシュ通知システム
4. **座席レイアウト管理**: 授業ごとの柔軟な座席配置変更機能

### プロジェクトスコープ
- **リアルタイム支援ダッシュボード**: 200席対応の座席マップとヘルプ要請管理
- **講師通知システム**: スマートフォン対応のプッシュ通知
- **座席レイアウトエディター**: 授業ごとの座席配置変更機能
- **データ分析基盤**: 授業改善のためのデータ永続化・分析機能

## 🎯 要件定義

### 機能要件

#### 1. 座席・ヘルプ要請管理機能
- **200席対応座席マップ**: 4×4グリッド基本の座席レイアウト表示
- **リアルタイムヘルプ要請**: 学生からのヘルプボタン押下の即座の可視化
- **緊急度判定システム**: エラー継続時間・無活動時間・ヘルプボタンによる自動優先度付け
- **座席レイアウトエディター**: 授業ごとの座席配置変更・保存機能

#### 2. 講師支援・通知機能
- **講師ステータス管理**: 1名講師の対応可能状況（AVAILABLE/IN_SESSION/BREAK/OFFLINE）
- **スマートフォン通知**: プッシュ通知によるヘルプ要請の即座の伝達
- **通知設定管理**: 通知ON/OFF・緊急度別通知設定
- **リアルタイム位置追跡**: 講師の教室内移動状況表示

#### 3. 学生データ管理機能
- **事前登録システム**: 学生名・ID・チーム番号・座席情報の事前登録
- **リアルタイム学習状況**: WebSocket APIを活用したセル実行・エラー状況監視
- **学習進捗追跡**: 個別学生の学習進度・困難箇所の特定
- **データ永続化**: 授業改善分析のための学習データ保存

#### 4. システム設定・分析機能
- **WebSocket更新間隔設定**: デフォルト5秒、設定変更可能
- **レスポンシブUI**: スマートフォン・デスクトップ両対応
- **データ分析ダッシュボード**: 授業効果測定・改善提案機能
- **認証システム**: 既存講師認証API（/api/v1/auth）との連携

### 非機能要件

#### パフォーマンス要件
- **初期表示**: 3秒以内での画面表示（200席対応）
- **リアルタイム更新**: 5秒間隔でのWebSocketデータ更新（設定変更可能）
- **大量データ処理**: 200席同時監視でも快適な操作性
- **レスポンシブ対応**: スマートフォン・デスクトップ両対応
- **通知応答性**: ヘルプ要請から1秒以内のプッシュ通知

#### 品質要件
- **可用性**: 99.9%以上の稼働率（授業中の安定性重視）
- **セキュリティ**: 既存講師認証APIとの連携、JWTトークン認証
- **ユーザビリティ**: 直感的な操作、緊急時の迅速対応
- **ブラウザ対応**: Chrome・Safari最新版対応（スマートフォンブラウザ含む）

## 🏗️ アーキテクチャベストプラクティス（実装検証済み）

### 責務分離の原則

#### ①JupyterLab拡張機能（cell-monitor-extension）
**✅ 現在の実装状況**: 完全に仕様に適合
- **責務**: 軽量なイベント送信クライアント専用
- **実装**: `src/index.ts`（18,876行）で全機能を単一ファイルに集約
- **データモデル**: `IStudentProgressData`（新）+ `ICellExecutionData`（旧）両対応
- **通信方式**: axios使用、リトライ機能付きHTTP POST
- **UI要素**: 通知のみ（ダッシュボード機能なし）
- **設定管理**: JupyterLab設定レジストリ統合

**ベストプラクティス**:
```typescript
// イベントキャプチャ → API送信のシンプルな流れ
const processCellExecution = (cell: any): void => {
  const progressData: IStudentProgressData = {
    eventId: generateUUID(),
    eventType: 'cell_executed',
    eventTime: new Date().toISOString(),
    // ... その他のデータ
  };
  sendProgressData([progressData]); // FastAPIに送信
};
```

#### ②フロントエンドダッシュボード（instructor-dashboard）
**✅ 現在の実装状況**: Phase 3完了（62個テスト成功）
- **責務**: 多機能ダッシュボードSPA（PC・スマホ対応）
- **アーキテクチャ**: React 18.3 + TypeScript + Material-UI 7.2
- **状態管理**: Zustand（authStore, dashboardStore）
- **通信**: axios（REST API）+ socket.io-client（WebSocket）
- **認証**: JWT トークンベース認証実装済み

**ディレクトリ構造**:
```
src/
├── components/
│   ├── auth/           # 認証関連（LoginForm等）
│   ├── classroom/      # 座席管理（SeatEditor, SeatAssignment等）
│   └── instructor/     # 講師機能（StatusPanel, NotificationSystem等）
├── stores/             # Zustand状態管理
├── services/           # API・WebSocket通信
└── types/              # TypeScript型定義
```

#### ③バックエンド（FastAPI）
**✅ 現在の実装状況**: 186個テスト成功
- **責務**: 中央集権的ハブ（全ビジネスロジック）
- **API**: 講師管理、LMS、イベント、バージョン管理、WebSocket
- **データベース**: PostgreSQL + Redis + InfluxDB
- **認証**: JWT + bcrypt実装済み

### 通信パターンのベストプラクティス

#### REST API設計
```typescript
// JupyterLab拡張 → FastAPI
POST /api/v1/events/notebook  // イベント受信用

// ダッシュボード → FastAPI
POST /api/v1/auth/login       // 講師ログイン
PUT /api/v1/instructors/me/status  // ステータス更新
GET /api/v1/dashboard/overview     // メインデータ取得
GET,POST,PUT,DELETE /api/v1/layouts // 座席管理
```

#### WebSocket統合
```typescript
// 認証付きWebSocket接続
const socket = io(`ws://your-domain/ws/${jwt_token}`);

// リアルタイム更新の受信
socket.on('help_request', (data) => {
  // 座席マップ更新
  updateSeatStatus(data.seatNumber, 'help_requested');
});

socket.on('instructor_status_update', (data) => {
  // 講師ステータス更新
  updateInstructorStatus(data.instructor_id, data.status);
});
```

## 🛠️ 技術仕様（実装済み）

### 実装済み技術スタック

#### cell-monitor-extension
- **JupyterLab**: 4.2.4
- **TypeScript**: 最新版
- **通信**: axios 1.10.0
- **設定**: @jupyterlab/settingregistry 4.2.4

#### instructor-dashboard
- **React**: 18.3.1（安定版）
- **TypeScript**: 4.9.5
- **Material-UI**: 7.2.0（最新版）
- **状態管理**: Zustand 4.4.0
- **通信**: axios 1.6.0 + socket.io-client 4.7.0
- **テスト**: Jest + React Testing Library 13.4.0
- **ルーティング**: react-router-dom 6.20.0

#### 開発・テスト環境
- **Jest**: ユニットテスト・スナップショットテスト
- **React Testing Library**: コンポーネントテスト
- **Playwright**: E2Eテスト・ブラウザ自動化
- **Storybook**: コンポーネント開発・ドキュメント化

### アーキテクチャ設計

#### プロジェクト構造
```
instructor-dashboard/
├── public/                     # 静的ファイル
│   ├── index.html
│   └── favicon.ico
├── src/
│   ├── components/             # 再利用可能コンポーネント
│   │   ├── common/            # 共通コンポーネント
│   │   │   ├── Layout/        # レイアウトコンポーネント
│   │   │   ├── Navigation/    # ナビゲーション
│   │   │   └── Loading/       # ローディング表示
│   │   ├── classroom/         # 教室関連コンポーネント
│   │   │   ├── SeatMap/       # 座席マップ表示
│   │   │   ├── SeatEditor/    # 座席レイアウトエディター
│   │   │   └── HelpRequest/   # ヘルプ要請表示
│   │   └── forms/             # フォーム関連コンポーネント
│   │       ├── NotificationSettings/ # 通知設定フォーム
│   │       └── SystemSettings/    # システム設定フォーム
│   ├── pages/                 # ページコンポーネント
│   │   ├── Dashboard/         # メインダッシュボード
│   │   ├── SeatManagement/    # 座席管理・レイアウトエディター
│   │   ├── StudentMonitor/    # 学生監視・進捗管理
│   │   ├── NotificationCenter/ # 通知センター
│   │   └── Analytics/         # データ分析・授業改善
│   │   │   └── History/      # 変更履歴
│   │   ├── Version/          # バージョン管理画面
│   │   │   ├── History/      # 履歴表示
│   │   │   ├── Branches/     # ブランチ管理
│   │   │   └── Compare/      # バージョン比較
│   │   └── System/           # システム監視画面
│   │       ├── WebSocket/    # WebSocket監視
│   │       └── Sync/         # 同期状況
│   ├── services/             # API通信層
│   │   ├── api.ts           # API基盤設定
│   │   ├── websocket.ts     # WebSocket管理
│   │   └── endpoints/       # エンドポイント別API
│   │       ├── environment.ts
│   │       ├── notebook-version.ts
│   │       ├── lms.ts
│   │       └── system.ts
│   ├── store/               # 状態管理
│   │   ├── auth.ts         # 認証状態
│   │   ├── dashboard.ts    # ダッシュボード状態
│   │   └── websocket.ts    # WebSocket状態
│   ├── types/              # TypeScript型定義
│   │   ├── api.ts         # API型定義
│   │   ├── dashboard.ts   # ダッシュボード型定義
│   │   └── common.ts      # 共通型定義
│   ├── utils/             # ユーティリティ
│   │   ├── formatters.ts  # データフォーマット
│   │   ├── validators.ts  # バリデーション
│   │   └── constants.ts   # 定数定義
│   ├── hooks/             # カスタムフック
│   │   ├── useWebSocket.ts # WebSocket管理
│   │   ├── useApi.ts      # API呼び出し
│   │   └── useAuth.ts     # 認証管理
│   ├── styles/            # スタイル定義
│   │   ├── theme.ts       # MUIテーマ
│   │   └── globals.css    # グローバルスタイル
│   ├── App.tsx            # アプリケーションルート
│   ├── main.tsx           # エントリーポイント
│   └── vite-env.d.ts      # Vite型定義
├── tests/                 # テストファイル
│   ├── __mocks__/         # モックファイル
│   ├── components/        # コンポーネントテスト
│   ├── pages/             # ページテスト
│   ├── services/          # サービステスト
│   └── e2e/              # E2Eテスト
├── .storybook/           # Storybook設定
├── package.json
├── tsconfig.json
├── vite.config.ts
├── playwright.config.ts
└── README.md
```

#### アーキテクチャ原則
1. **コンポーネント指向設計**: 再利用可能・保守しやすいコンポーネント設計
2. **型安全性の確保**: TypeScriptによる厳密な型チェック
3. **状態管理の最適化**: ローカル状態・サーバー状態の適切な分離
4. **パフォーマンス最適化**: 遅延読み込み・メモ化・仮想化の活用
5. **テスタビリティ**: テストしやすい設計・依存性注入

## 🎨 UI/UX設計方針

### デザインシステム

#### カラーパレット
- **プライマリ**: #1976d2 (Material Blue)
- **セカンダリ**: #dc004e (Material Pink)
- **成功**: #2e7d32 (Green)
- **警告**: #ed6c02 (Orange)
- **エラー**: #d32f2f (Red)
- **情報**: #0288d1 (Light Blue)

#### タイポグラフィ
- **フォントファミリー**: "Roboto", "Helvetica", "Arial", sans-serif
- **見出し**: h1-h6の階層的な見出し設計
- **本文**: 読みやすさを重視したフォントサイズ・行間

#### レイアウト原則
- **グリッドシステム**: 12カラムレスポンシブグリッド
- **スペーシング**: 8pxベースのスペーシングシステム
- **ブレークポイント**: xs(0px), sm(600px), md(900px), lg(1200px), xl(1536px)

### 開発フェーズ（新仕様対応・実装済み基盤活用）

#### ✅ Phase 1-3: 完了済み（62個テスト成功）
**実装済み機能**:
- **認証システム**: JWT認証・講師ログイン（完全実装済み）
- **座席管理**: SeatEditor（24個テスト成功）・SeatAssignment（19個テスト成功）
- **レイアウト管理**: LayoutTemplates（19個テスト成功）
- **講師ステータス**: StatusPanel・NotificationSystem（実装済み）
- **WebSocket統合**: リアルタイム通信基盤（完全実装済み）

#### 🔄 Phase 4: スマホ対応最適化（2週間）
**新仕様対応項目**:
- **Week 1**: スマートフォンUI最適化
  - StatusPanel のモバイル専用レスポンシブ対応
  - タッチ操作最適化・大きなボタンサイズ
  - 縦画面レイアウト最適化
  - PWA対応（ホーム画面追加・オフライン対応）

- **Week 2**: 講師個別認証・ステータス管理強化
  - 複数講師対応（現在は1名想定）
  - 講師ID別ステータス履歴管理
  - スマホでの簡単ステータス切り替えUI
  - プッシュ通知のスマホ最適化

#### 🚀 Phase 5: 高度機能・分析（3週間）
- **Week 3**: データ分析・可視化機能
  - 講師効率分析ダッシュボード
  - 学生支援履歴・傾向分析
  - Chart.js活用の統計グラフ

- **Week 4**: E2E統合テスト・パフォーマンス最適化
  - Playwright E2Eテスト実装
  - 200席対応の負荷テスト
  - WebSocket接続安定性テスト

- **Week 5**: 本番デプロイ・運用準備
  - Docker本番環境構築
  - CI/CD パイプライン整備
  - 監視・ログ収集システム依存関係可視化・バージョン管理
- **変更履歴**: 環境変更の時系列表示・差分分析

#### 4. バージョン管理画面
- **履歴表示**: コミット履歴・ブランチ表示
- **比較機能**: バージョン間差分表示
{{ ... }}
- **統計情報**: 利用状況・活動統計

### ユーザビリティ原則
1. **直感的な操作**: 一般的なUI/UXパターンの採用
2. **効率的なワークフロー**: 最小クリック数での目標達成
3. **視覚的階層**: 重要度に応じた視覚的優先順位
4. **フィードバック**: 操作結果の明確な表示
5. **エラー防止**: バリデーション・確認ダイアログの適切な配置

## 📅 開発計画

### 開発フェーズ

#### フェーズ1: 基盤構築（2週間）
**目標**: 開発環境・基盤機能の構築

**主要タスク**:
- [ ] プロジェクト初期化・技術スタック導入
- [ ] 開発環境構築（Vite・TypeScript・ESLint・Prettier）
- [ ] API通信基盤構築（Axios・React Query設定）
- [ ] WebSocket接続基盤構築（カスタムフック・状態管理）
- [ ] 基本レイアウト・ナビゲーション実装
- [ ] 認証・ルーティング基盤構築
- [ ] テスト環境構築（Jest・React Testing Library・Playwright）

**成果物**:
- 基本的なプロジェクト構造
- API・WebSocket通信基盤
- 基本レイアウト・ナビゲーション
- テスト環境・CI/CD設定

#### フェーズ2: コア機能実装（3週間）
**目標**: メインダッシュボード・リアルタイム機能の実装

**主要タスク**:
- [ ] メインダッシュボード画面実装
- [ ] リアルタイム学習状況表示（WebSocket連携）
- [ ] 基本的なチャート・統計表示（Chart.js連携）
- [ ] KPI表示・アクティビティフィード
- [ ] レスポンシブデザイン対応
- [ ] パフォーマンス最適化（遅延読み込み・メモ化）
- [ ] ユニットテスト・インテグレーションテスト作成

**成果物**:
- 機能するメインダッシュボード
- リアルタイムデータ表示機能
- 基本的なチャート・統計機能
- レスポンシブ対応

#### フェーズ3: 詳細機能実装（4週間）
**目標**: LMS・環境監視・バージョン管理機能の実装

**主要タスク**:
- [ ] LMS管理画面実装
  - [ ] Classes API連携（クラス管理）
  - [ ] Assignments API連携（課題管理）
  - [ ] Submissions API連携（提出管理）
- [ ] 環境監視画面実装
  - [ ] Environment API連携（ヘルス・パッケージ・履歴）
  - [ ] 環境問題アラート機能
- [ ] バージョン管理画面実装
  - [ ] Notebook Version API連携（履歴・ブランチ・比較）
  - [ ] バージョン統計・可視化
- [ ] フォーム・バリデーション機能
- [ ] データエクスポート・インポート機能

**成果物**:
- 完全なLMS管理機能
- 環境監視・アラート機能
- バージョン管理・比較機能
- データ操作機能

#### フェーズ4: 高度機能・最適化（2週間）
**目標**: システム監視・最適化・品質向上

**主要タスク**:
- [ ] システム監視画面実装
  - [ ] WebSocket接続監視
  - [ ] Offline Sync状況表示
  - [ ] システム全体監視
- [ ] パフォーマンス最適化
  - [ ] バンドルサイズ最適化
  - [ ] 遅延読み込み・コード分割
  - [ ] キャッシュ戦略最適化
- [ ] アクセシビリティ改善（WCAG 2.1 AA準拠）
- [ ] UX改善・ユーザビリティテスト
- [ ] E2Eテスト・ビジュアルリグレッションテスト
- [ ] ドキュメント・デプロイ準備

**成果物**:
- 完全なシステム監視機能
- 最適化されたパフォーマンス
- アクセシブルなUI/UX
- 包括的なテストスイート

### 開発体制

#### 推奨チーム構成
- **フロントエンド開発者**: 2-3名（React・TypeScript経験者）
- **UI/UXデザイナー**: 1名（Material Design・ダッシュボード設計経験者）
- **QAエンジニア**: 1名（フロントエンドテスト・アクセシビリティ検証経験者）

#### AI駆動開発の活用
- **コンポーネント生成**: AIを活用した基本コンポーネントの自動生成
- **テストコード生成**: AIを活用したユニットテスト・インテグレーションテストの生成
- **コードレビュー**: AIを活用したコード品質・セキュリティチェック
- **ドキュメント生成**: AIを活用したコンポーネントドキュメント・API仕様書の自動生成

## 🧪 品質保証計画

### テスト戦略

#### 1. ユニットテスト
- **対象**: 個別コンポーネント・ユーティリティ関数・カスタムフック
- **ツール**: Jest + React Testing Library
- **カバレッジ目標**: 80%以上
- **実行タイミング**: 開発時・CI/CD時

#### 2. インテグレーションテスト
- **対象**: API連携・WebSocket通信・状態管理
- **ツール**: Jest + MSW（Mock Service Worker）
- **カバレッジ目標**: 主要ワークフローの100%
- **実行タイミング**: フィーチャー完成時・CI/CD時

#### 3. E2Eテスト
- **対象**: ユーザーシナリオ・クリティカルパス
- **ツール**: Playwright
- **カバレッジ目標**: 主要ユースケースの100%
- **実行タイミング**: リリース前・定期実行

#### 4. ビジュアルリグレッションテスト
- **対象**: UI・レイアウト・レスポンシブデザイン
- **ツール**: Playwright + Visual Comparisons
- **カバレッジ目標**: 全画面・主要コンポーネント
- **実行タイミング**: UI変更時・リリース前

### パフォーマンス監視

#### 1. Core Web Vitals
- **LCP (Largest Contentful Paint)**: 2.5秒以下
- **FID (First Input Delay)**: 100ms以下
- **CLS (Cumulative Layout Shift)**: 0.1以下

#### 2. バンドルサイズ監視
- **初期バンドル**: 500KB以下（gzip圧縮後）
- **チャンク分割**: ページ別・機能別の適切な分割
- **Tree Shaking**: 未使用コードの自動除去

#### 3. リアルタイム監視
- **WebSocket接続**: 接続状況・レイテンシ監視
- **API応答時間**: エンドポイント別応答時間監視
- **エラー監視**: JavaScript エラー・ネットワークエラーの監視

### セキュリティ対策

#### 1. 認証・認可
- **JWT認証**: セキュアなトークンベース認証
- **ロールベースアクセス制御**: ユーザー権限に応じた機能制限
- **セッション管理**: 適切なセッションタイムアウト・更新

#### 2. データ保護
- **入力サニタイゼーション**: XSS攻撃対策
- **CSRF対策**: トークンベースCSRF保護
- **HTTPS通信**: 全通信の暗号化

#### 3. 依存関係管理
- **脆弱性スキャン**: npm audit・Snyk等による定期スキャン
- **依存関係更新**: 定期的なライブラリ更新・セキュリティパッチ適用

## ⚠️ リスク分析と対策

### 技術リスク

#### 1. パフォーマンスリスク
**リスク**: 大量データ処理時のパフォーマンス低下
**対策**:
- 仮想化（react-window）の導入
- ページネーション・無限スクロール実装
- データフェッチング最適化（React Query）

#### 🏆 成功指標（新仕様完全対応）

### 技術的成功指標

#### ✅ 既存成果の維持
- **テスト成功率**: 62個テストの100%成功維持
- **TypeScriptコンパイル**: エラー0件維持
- **Docker環境**: 安定動作維持
- **WebSocket統合**: リアルタイム通信の安定性維持

#### 🔄 新仕様対応指標
- **スマホ対応**: 全機能のモバイルファースト対応達成
- **PWA機能**: ホーム画面追加・オフライン対応実装
- **プッシュ通知**: Service Worker統合・スマホ最適化
- **講師認証**: 複数講師対応・個別ステータス管理

#### 📊 パフォーマンス指標
- **初期読み込み**: 3秒以内（スマホ含む）
- **タップ応答**: 100ms以内
- **WebSocket応答**: 1秒以内
- **200席同時更新**: 5秒以内でUI更新完了

### ユーザビリティ成功指標
- 監視・アラート機能実装
- ロールバック計画策定

## 🚀 次のステップ

### 即座に実行可能なアクション
1. **技術スタック確定**: React + TypeScript + MUI + Chart.js構成の承認
2. **プロジェクト初期化**: Vite + TypeScript プロジェクトの作成
3. **開発環境構築**: ESLint・Prettier・Jest・Playwright環境構築
4. **API型定義作成**: バックエンドAPI（63個のテスト成功）に基づく型定義

### 中期的な準備事項
1. **デザインシステム構築**: MUIベースのカスタムテーマ・コンポーネント作成
2. **モックデータ準備**: 開発・テスト用のモックデータ作成
3. **CI/CD構築**: GitHub Actions等による自動テスト・デプロイ環境構築

### 長期的な展望
1. **PWA対応**: プログレッシブWebアプリ化による利便性向上
2. **多言語対応**: i18n対応による国際化
3. **アクセシビリティ強化**: より包括的なアクセシビリティ対応

---

このフロントエンドダッシュボード開発計画書は、AI駆動TDDで確立された63個のテストケース完全成功を基盤として、高品質なダッシュボード開発を実現するための包括的なガイドラインです。段階的な開発アプローチにより、リスクを最小化しながら価値のある機能を継続的に提供していきます。
