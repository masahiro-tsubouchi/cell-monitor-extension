# プロジェクト統合ロードマップ

> **最終更新日**: 2025-07-22
> **ステータス**: 講師ログイン機能完全実装完了。AI駆動TDD累積186個テスト成功。

## フェーズ1: 基本LMS機能とリアルタイム監視基盤の構築 (完了)

- [x] **コアAPI & データ収集**
  - [x] JupyterLabからのイベント受信API (`/api/v1/events`)
  - [x] セル実行監視API (`/api/v1/cell_monitor`)
  - [x] WebSocketによるリアルタイム通信基盤
  - [x] Redis Pub/Subによる非同期イベント処理

- [x] **LMS機能 (CRUD API)**
  - [x] クラス管理 (`/api/v1/classes`)
  - [x] 課題管理 (`/api/v1/assignments`)
  - [x] 課題提出管理 (`/api/v1/submissions`)

- [x] **リアルタイム進捗管理**
  - [x] 学習進捗API (`/api/v1/progress`)
  - [x] リアルタイム進捗通知機能

- [x] **開発基盤**
  - [x] AI駆動TDDによる品質保証（単体・統合テスト57項目）
  - [x] CI/CDパイプラインの構築 (GitHub Actions)
  - [x] Dockerによる開発環境の一貫性確保

## フェーズ2: 既存機能の品質強化と統合テスト (進行中)

### 既存実装済み機能の確認・強化

- [x] **高度なAPI機能群（実装済み）**
  - [x] オフライン同期API (`/api/v1/offline_sync`) - 完全実装済み
  - [x] ノートブックバージョン管理API (`/api/v1/notebook_version`) - 完全実装済み
  - [x] 実行環境情報API (`/api/v1/environment`) - 完全実装済み
  - [x] リアルタイム進捗API (`/api/v1/realtime_progress`) - 完全実装済み

### 品質強化タスク

- [ ] **既存APIのテスト品質確認**
  - [ ] `test_environment.py`のテスト実行・品質評価
  - [ ] `test_notebook_version.py`のテスト実行・品質評価
  - [ ] `test_progress.py`のテスト実行・品質評価
  - [ ] オフライン同期APIのテスト作成・実行

- [ ] **統合テスト・E2Eテストの強化**
  - [ ] API間連携テストの設計・実装
  - [ ] オフライン→オンライン復帰シナリオのE2Eテスト
  - [ ] ノートブックバージョン管理の統合テスト

### 講師ログイン機能・状態管理システム実装

- [x] **Phase 1: 基盤構築（AI駆動TDD）** ✅ **完了**
  - [x] 依存パッケージ追加（alembic==1.13.1）
  - [x] Alembic初期化・設定（alembic.ini, env.py）
  - [x] データベースマイグレーション実行
    - [x] `instructors`テーブル作成（email, password_hash, status等）
    - [x] `instructor_status_history`テーブル作成（状態履歴管理）
    - [x] 既存`classes`テーブルに`instructor_id`追加
  - [x] SQLAlchemyモデル定義（`Instructor`, `InstructorStatusHistory`）
  - [x] **AI駆動TDD**: 12個のテストケース全成功（PostgreSQL環境）

- [ ] **Phase 2: 認証・セキュリティ実装**
  - [x] セキュリティ機能実装（`core/security.py`） ✅ **完了**
    - [x] パスワードハッシュ化（bcrypt）
    - [x] JWT トークン生成・検証
    - [x] 依存性注入による認証チェック
  - [x] **AI駆動TDD**: 17個のテストケース全成功（PostgreSQL環境）
  - [x] Pydanticスキーマ定義 ✅ **完了**
    - [x] `InstructorCreate`, `InstructorLogin`, `InstructorResponse`
    - [x] `InstructorStatusUpdate`, `InstructorStatusResponse`, `TokenResponse`, `LoginResponse`
  - [x] **AI駆動TDD**: 21個のテストケース全成功（PostgreSQL環境）
  - [x] CRUD操作実装（`crud/instructor.py`） ✅ **完了**
    - [x] 講師作成・認証・ステータス更新
    - [x] パスワード変更・プロフィール更新・論理削除・履歴管理
  - [x] **AI駆動TDD**: 21個のテストケース全成功（PostgreSQL環境）

- [x] **Phase 3: API エンドポイント実装** ✅ **完了**
  - [x] 認証API（`/api/v1/auth`） ✅ **完了**
    - [x] `POST /login` - 講師ログイン
    - [x] `POST /logout` - ログアウト
    - [x] `GET /me` - 現在の講師情報取得
    - [x] `PUT /password` - パスワード変更
  - [x] **AI駆動TDD**: 14個のテストケース全成功（PostgreSQL環境）

- [x] **Phase 4: WebSocket統合・リアルタイム状態管理** ✅ **完全達成**
  - [x] WebSocket統合（`api/endpoints/instructor_websocket.py`） ✅ **完了**
    - [x] 講師認証付きWebSocket接続（JWT認証）
    - [x] 講師ステータス変更のリアルタイム通知
    - [x] InstructorConnectionManager実装
    - [x] **AI駆動TDD**: 5個のテストケース全成功（PostgreSQL環境）
  - [x] 学生-講師間リアルタイム通信 ✅ **完了**
  - [x] イベント連携（`worker/event_router.py`拡張） ✅ **完了**
    - [x] 学生セッション開始時の講師ステータス自動更新
    - [x] 講師-学生マッチング機能
    - [x] **AI駆動TDD**: 6個のテストケース全成功（PostgreSQL環境）

- [x] **Phase 5: 講師管理API実装** ✅ **完全達成**
  - [x] 講師管理API（`/api/v1/instructors`） ✅ **完了**
    - [x] `GET /` - 講師一覧取得（ページネーション・フィルター対応）
    - [x] `POST /` - 新規講師作成（重複チェック・バリデーション）
    - [x] `GET /{instructor_id}` - 講師詳細取得
    - [x] `PUT /{instructor_id}` - 講師情報更新（部分更新対応）
    - [x] `DELETE /{instructor_id}` - 講師削除（論理削除・自己削除防止）
  - [x] **AI駆動TDD**: 14個のテストケース全成功（PostgreSQL環境）
  - [x] 認証・DBセッション統合・エラーハンドリング完全実装

- [x] **Phase 6: 講師ステータス管理API実装** ✅ **完全達成**
  - [x] 講師ステータス管理API（`/api/v1/instructor_status`） ✅ **完了**
    - [x] `GET /{instructor_id}` - 現在ステータス取得
    - [x] `PUT /{instructor_id}` - ステータス更新（履歴自動記録）
    - [x] `GET /{instructor_id}/history` - ステータス履歴取得（ページネーション対応）
    - [x] `POST /bulk` - 一括ステータス更新（部分成功対応）
  - [x] **AI駆動TDD**: 13個のテストケース全成功（PostgreSQL環境）
  - [x] 外部キー制約・属性エラー・統合フロー完全対応

- [x] **Phase 7: AI駆動TDD統合テスト** ✅ **完了**
  - [x] 単体テスト（`tests/crud/test_instructor.py`） ✅ **完了**
    - [x] 講師CRUD操作テスト（21個のテストケース）
    - [x] 認証・パスワードハッシュ化テスト
    - [x] ステータス管理テスト
  - [x] APIテスト（`tests/api/test_auth.py`） ✅ **完了**
    - [x] 認証フローテスト（ログイン・ログアウト・トークン検証）
    - [x] 14個のテストケース全成功
  - [x] APIテスト（`tests/api/test_instructor_management.py`） ✅ **完了**
    - [x] 講師管理API完全テスト（CRUD操作・認証・エラーハンドリング）
    - [x] 14個のテストケース全成功
  - [x] APIテスト（`tests/api/test_instructor_status_management.py`） ✅ **完了**
    - [x] 講師ステータス管理API完全テスト（ステータス・履歴・一括更新）
    - [x] 13個のテストケース全成功
  - [x] WebSocketテスト（`tests/websocket/test_instructor_websocket.py`） ✅ **完了**
    - [x] WebSocket + 講師認証統合テスト
    - [x] 講師ステータス変更リアルタイム通知テスト
    - [x] 5個のテストケース全成功
  - [x] イベント統合テスト（`tests/worker/test_instructor_event_integration.py`） ✅ **完了**
    - [x] 学生セッション開始時の講師ステータス自動更新テスト
    - [x] 講師-学生リアルタイム通信テスト
    - [x] 6個のテストケース全成功

## 🏆 AI駆動TDD累積成果

**合計: 186個のテストケース完全成功** ✅

- **Phase 1（基盤構築）**: 12個のテストケース ✅
- **Phase 2（認証・セキュリティ・スキーマ・CRUD）**: 59個のテストケース ✅
- **Phase 3（認証API）**: 14個のテストケース ✅
- **Phase 4（WebSocket統合）**: 5個のテストケース ✅
- **Phase 4（イベント統合）**: 6個のテストケース ✅
- **Phase 5（講師管理API）**: 14個のテストケース ✅
- **Phase 6（講師ステータス管理API）**: 13個のテストケース ✅
- **既存機能**: 63個のテストケース ✅

### 🚀 主要機能実装完了

1. **講師テーブル・スキーマ設計** - PostgreSQL環境での完全なデータベース設計
2. **JWT認証システム** - bcryptパスワードハッシュ化、トークン管理
3. **CRUD操作** - 講師作成・取得・更新・削除・認証
4. **認証API** - ログイン・ログアウト・パスワード変更・現在ユーザー取得
5. **講師管理API** - 完全CRUD操作、ページネーション、フィルター、論理削除
6. **講師ステータス管理API** - ステータス更新、履歴管理、一括更新
7. **WebSocket統合** - JWT認証付きリアルタイム通信
8. **イベント統合** - 学生セッション開始時の講師ステータス自動更新
9. **マッチング機能** - 講師-学生自動割り当てシステム

**実装優先度**: 高（フロントエンドUI実装の前提条件）
**推定工数**: ~~2-3週間~~ → **1週間で完了**（AI駆動TDDによる効率化）
**成功指標**: ~~全テストケース成功（目標：20-25個のテストケース）~~ → **159個のテストケース完全成功** 🎯

- [ ] **ドキュメント同期**
  - [ ] `FASTAPI_SERVER_SPEC.md`への既存API仕様追加
  - [ ] テスト結果・品質レポートの作成

## フェーズ3: 新機能開発と外部連携 (将来構想)

### 真に未実装の新機能

- [ ] **学生行動分析ダッシュボード**
  - [ ] 集計・分析API (`/api/v1/analytics`) の設計・実装
  - [ ] 教師向け・学生向けダッシュボード用データAPI

- [ ] **外部システム連携**
  - [ ] 外部LMSとの連携 (例: Moodle, Google Classroom)
  - [ ] AIによる学習レコメンデーション機能

## フェーズ4: 高度化・運用最適化 (将来構想)

- [ ] **外部LMSとの連携** (例: Moodle, Google Classroom)
- [ ] **AIによる学習レコメンデーション機能**
- [ ] **管理者向け分析ダッシュボードの高度化**


> **統合ドキュメント**: ROADMAP.md + DEVELOPMENT_PLAN.md
> **最終更新日**: 2025-01-19
> **目的**: 次のアクションが明確に分かる実行可能な計画書

## 🎯 現在の状況（2025年1月時点）

### ✅ 完了済み項目
- [x] Docker環境構築・全コンテナ起動確認
- [x] FastAPI統一エンドポイント実装（`/api/v1/events`）
- [x] Redis Pub/Sub によるイベント配信
- [x] E2Eテスト自動化（Playwright + pytest）
- [x] JupyterLab拡張機能のプロキシ経由動作確認
- [x] テスト用API実装（`/api/v1/test/events`）
- [x] WebSocket通信基盤
- [x] PostgreSQL・InfluxDB・Redis統合
- [x] バックグラウンドワーカー実装
- [x] 包括的ドキュメント作成

### 🚧 進行中・次のアクション

#### ✅ 最近完了した主要成果
- [x] **LMS機能完全実装**: Classes/Assignments/Submissions API (57/57テスト成功)
- [x] **AI駆動TDD実証**: テストファースト開発の標準化
- [x] **CI/CDパイプライン**: GitHub Actionsで全テスト自動化
- [x] **データ連携仕様書**: JupyterLab↔FastAPI間の完全マッピング
- [x] **ドキュメント体系化**: テスト手順書・API仕様書の整備

## 📋 **今すぐやるべきこと（優先度順）**

### 🔥 **最優先（今週中）**

#### 1. CI/CD自動テストパイプライン構築
**目標**: GitHub Actions でプルリクエスト時の自動テスト実行

**具体的タスク**:
```yaml
# .github/workflows/test.yml, e2e-test.yml
- [x] 単体テスト自動実行 (pytest)
- [x] E2Eテスト自動実行 (Playwright)
- [x] リント・フォーマットチェック (black, flake8)
- [ ] コードカバレッジ測定 (coverage.py)
```

**参考ドキュメント**: [E2Eテスト設定](./testing/E2E_TEST_GUIDE.md)

#### 2. 非同期Worker最適化
**目標**: イベント処理の信頼性・パフォーマンス向上

**具体的タスク**:
```python
# worker/event_router.py 改善
- [ ] バッチ処理実装（InfluxDB書き込み最適化）
- [ ] エラーハンドリング強化（指数バックオフリトライ）
- [ ] デッドレターキュー実装
- [ ] メトリクス収集機能追加
```

**参考ドキュメント**: [FastAPI Server仕様](./architecture/FASTAPI_SERVER_SPEC.md)

#### 3. 🔗 データ連携課題の段階的改善
**目標**: JupyterLab拡張機能とFastAPIサーバー間のデータ連携品質向上

**🔴 短期改善（1-2週間）**:
```python
# 高優先度課題の解決
- [ ] バッチ処理対応: 最大100件のイベントをまとめて送信
- [ ] エラー詳細記録強化: スタックトレース全体の保存
- [ ] オフライン対応基盤: IndexedDBでのローカルキューイング
- [ ] 型エラー修正: mypy型チェック55個のエラー解消
```

**🟡 中期改善（1-2ヶ月）**:
```python
# データ管理・分析機能強化
- [ ] ノートブックバージョン管理: Git風の差分管理システム導入
- [ ] 学習分析機能強化: 学習時間・集中度の自動計測
- [ ] リアルタイム進捗表示: 課題進捗率のライブ更新
- [ ] セル実行環境情報: Python版数・パッケージ情報記録
```

**🔵 長期改善（3-6ヶ月）こちらは後で考えること**:
```python
# AI支援・高度分析機能
- [ ] AI支援機能: エラーパターン学習による自動提案
- [ ] 高度な分析機能: 学習効率最適化提案
- [ ] 教材難易度自動調整: 個人適応型学習支援
```

**参考ドキュメント**: [データ連携仕様](./architecture/EVENT_FLOW.md)

### ⚡ **高優先度（今月中）**

#### 3. リアルタイムダッシュボード開発
**目標**: 講師向けWebダッシュボードの基本機能完成

**具体的タスク**:
```typescript
# フロントエンド開発（React + TypeScript）
- [ ] プロジェクト初期化（Create React App / Vite）
- [ ] WebSocket接続コンポーネント
- [ ] リアルタイム進捗表示画面
- [ ] 学生一覧・個別詳細画面
```

**AI駆動開発戦略**:
```typescript
// AIに依頼する具体的タスク例
"""
以下のReactコンポーネントを作成してください:
1. StudentProgressOverview: クラス全体の進捗一覧
2. RealTimeEventFeed: リアルタイムイベント表示
3. NotebookHeatmap: 課題のホットスポット表示
WebSocket接続とTailwind CSSでのスタイリングを含める
"""
```

#### 4. データベース最適化・インデックス設計
**目標**: 200ユーザー対応のパフォーマンス確保

**具体的タスク**:
```sql
-- PostgreSQL最適化
- [ ] 適切なインデックス作成
- [ ] クエリパフォーマンス測定
- [ ] パーティショニング検討
- [ ] 接続プール設定調整
```

**参考ドキュメント**: [パフォーマンス要件](./architecture/PERFORMANCE_REQUIREMENTS.md)

### 📈 **中優先度（来月中）**

#### 5. 監視・ログ基盤構築
**目標**: 本番運用に向けた監視体制確立

**具体的タスク**:
```yaml
# 監視スタック構築
- [ ] Prometheus + Grafana 導入
- [ ] アプリケーションメトリクス実装
- [ ] アラート設定
- [ ] ログ集約（ELK Stack検討）
```

#### 6. セキュリティ強化
**目標**: 基本的なセキュリティ対策実装

**具体的タスク**:
```python
# セキュリティ機能実装
- [ ] API認証（JWT / OAuth2.0）
- [ ] レート制限実装
- [ ] CORS設定最適化
- [ ] 入力値検証強化
```

### 🔮 **低優先度（将来実装）**

#### 7. AI分析機能
**目標**: 学習パターン分析・予測機能

**具体的タスク**:
```python
# AI/ML機能実装
- [ ] 学習困難者検出アルゴリズム
- [ ] つまずきポイント特定
- [ ] 個別指導提案システム
- [ ] 自動レポート生成
```

## 🗓️ **週次実行計画**

### 第1週（1/20-1/26）
- **月**: CI/CD パイプライン設計・GitHub Actions設定
- **火**: 単体テスト・E2Eテスト自動化実装
- **水**: Worker最適化・バッチ処理実装
- **木**: エラーハンドリング強化・リトライ機構
- **金**: 週次レビュー・次週計画

### 第2週（1/27-2/2）
- **月**: React プロジェクト初期化・環境構築
- **火**: WebSocket接続コンポーネント実装
- **水**: 学生進捗一覧画面開発
- **木**: リアルタイムイベント表示機能
- **金**: 週次レビュー・デモ実施

### 第3週（2/3-2/9）
- **月**: データベースインデックス設計・実装
- **火**: クエリパフォーマンス測定・最適化
- **水**: 接続プール設定・負荷テスト
- **木**: 監視基盤設計・Prometheus導入
- **金**: 週次レビュー・パフォーマンス評価

### 第4週（2/10-2/16）
- **月**: Grafana ダッシュボード作成
- **火**: アラート設定・通知機能
- **水**: セキュリティ機能実装開始
- **木**: API認証・認可機能
- **金**: 月次レビュー・次月計画

## 🔄 **継続的改善プロセス**

### 日次チェック
- [ ] **朝**: 前日の進捗確認・当日タスク明確化
- [ ] **夕**: 完了タスク確認・課題抽出・翌日計画

### 週次レビュー（毎週金曜日）
- [ ] **進捗確認**: 完了タスク・遅延タスクの評価
- [ ] **課題特定**: ブロッカー・技術的課題の洗い出し
- [ ] **AI活用評価**: AI生成コードの品質・効率性評価
- [ ] **次週計画**: 優先度調整・タスク詳細化

### 月次評価
- [ ] **成果物デモ**: ステークホルダー向けデモ実施
- [ ] **技術負債確認**: リファクタリング必要箇所の特定
- [ ] **ドキュメント更新**: 実装に合わせたドキュメント同期
- [ ] **ロードマップ調整**: 進捗に応じた計画見直し

## 🚀 **AI駆動開発の実践方法**

### コード生成時のベストプラクティス
```python
# AIへの効果的な指示例
"""
以下の機能を実装してください:
【目的】: セル実行イベントのバッチ処理最適化
【要件】:
- 100件単位でのInfluxDB書き込み
- 5秒間隔または100件到達時の自動フラッシュ
- エラー時の個別リトライ機構
【制約】:
- 既存のevent_router.pyを拡張
- ログ出力とメトリクス収集を含める
【参考】: fastapi_server/worker/event_router.py
"""
```

### テスト駆動開発の実践
```python
# AIによるテストケース生成例
"""
以下のテストケースを作成してください:
【対象】: バッチ処理機能
【テストケース】:
1. 正常系: 100件バッチ処理の成功
2. 異常系: InfluxDB接続エラー時のリトライ
3. 境界値: 1件・99件・101件の処理
4. パフォーマンス: 1000件処理時間の測定
【フレームワーク】: pytest + pytest-asyncio
"""
```

## 📊 **成功指標・KPI**

### 技術指標（月次測定）
- **レスポンス時間**: API < 100ms、WebSocket < 50ms
- **スループット**: 100 req/s（通常）、300 req/s（ピーク）
- **稼働率**: 99.5%以上
- **テストカバレッジ**: 80%以上

### 開発効率指標（週次測定）
- **AI活用率**: コード生成での AI 活用割合
- **バグ発見率**: テスト段階でのバグ検出率
- **デプロイ頻度**: 週次デプロイの実現
- **リードタイム**: 機能要求から実装完了までの時間

## 🎯 **マイルストーン**

### 2025年2月末：基盤完成
- [x] バックエンド基盤構築完了
- [ ] CI/CD パイプライン稼働
- [ ] リアルタイム通知機能完成
- [ ] 基本的な監視機能実装

### 2025年3月末：ダッシュボード完成
- [ ] React ダッシュボード基本機能
- [ ] WebSocket リアルタイム更新
- [ ] 学生進捗可視化機能
- [ ] パフォーマンス最適化完了

### 2025年4月末：本番運用準備
- [ ] セキュリティ機能実装
- [ ] 負荷テスト・性能検証
- [ ] 運用監視体制確立
- [ ] ドキュメント完全整備

### 2025年5月末：AI機能実装
- [ ] 学習パターン分析機能
- [ ] 異常検知・アラート機能
- [ ] 自動レポート生成
- [ ] 個別指導提案システム

## 🔧 **開発環境・ツール**

### 必須ツール
- **IDE**: VSCode + AI拡張機能
- **コンテナ**: Docker + Docker Compose
- **テスト**: pytest + Playwright
- **CI/CD**: GitHub Actions
- **監視**: Prometheus + Grafana

### AI開発支援ツール
- **コード生成**: GitHub Copilot / ChatGPT
- **コードレビュー**: AI支援レビュー
- **ドキュメント**: AI自動生成 + 人間レビュー
- **テスト**: AI テストケース生成

## 📚 **関連ドキュメント・参照先**

### 設計・仕様
- [FastAPI Server詳細仕様](./architecture/FASTAPI_SERVER_SPEC.md)
- [API データ仕様](./architecture/API_DATA_SPEC.md)
- [パフォーマンス要件](./architecture/PERFORMANCE_REQUIREMENTS.md)

### 開発・テスト
- [ビルド・配布ガイド](./development/BUILD_AND_DISTRIBUTION.md)
- [E2Eテストガイド](./testing/E2E_TEST_GUIDE.md)
- [AI駆動開発ガイド](./ai-driven/README.md)

### 運用・保守
- [トラブルシューティング](./troubleshooting/README.md)
- [プロジェクトルール](./PROJECT_RULES.md)

---

## 🎯 **今日やること（アクションアイテム）**

### 即座に実行可能なタスク
1. **CI/CD設定**: `.github/workflows/ci.yml` 作成
2. **Worker最適化**: `worker/event_router.py` のバッチ処理実装
3. **テスト強化**: 単体テスト・E2Eテストの追加
4. **ドキュメント同期**: 実装変更に合わせたドキュメント更新

### AI活用の具体例
```bash
# 今日のAI活用タスク
1. CI/CDワークフロー生成: "GitHub ActionsでFastAPI + Reactのテスト自動化"
2. バッチ処理実装: "InfluxDBへの効率的なバッチ書き込み機能"
3. エラーハンドリング: "指数バックオフによるリトライ機構"
4. テストケース生成: "非同期処理の包括的テストケース"
```

**次のアクションが明確になったら、すぐに実行に移しましょう！**
